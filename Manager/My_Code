namespace Smart_Item_Manager
{
    internal class Program
    {
        public abstract class Item
        {
            public string name { get; set; }
            public int amount_in_frige { get; set; }
            public DateTime experationDate { get; set; }
            public string commentAboutItem {  get; set; }
            public string reminderRegardingItem { get; set; }
            public static int countTotalItemsCreated = 0;
            protected Item(string name, int amount_in_frige, DateTime experationDate)
            {
                this.name = name;
                this.amount_in_frige = amount_in_frige;
                this.experationDate = experationDate;
                this.commentAboutItem = "";
                this.reminderRegardingItem = "";
                countTotalItemsCreated++;
            }

            public override bool Equals(object? obj)
            {
                return base.Equals(obj);
            }

            public override int GetHashCode()
            {
                return base.GetHashCode();
            }

            public override string? ToString()
            {
                return base.ToString();
            }
        }
        public class Food : Item
        {
            public Food(string name, int amount_in_frige, DateTime experationDate) : base(name, amount_in_frige, experationDate)
            {
            }

            public override bool Equals(object? obj)
            {
                return base.Equals(obj);
            }

            public override int GetHashCode()
            {
                return base.GetHashCode();
            }

            public override string? ToString()
            {
                return base.ToString();
            }
        }
        public class Drink : Item
        {
            public Drink(string name, int amount_in_frige, DateTime experationDate) : base(name, amount_in_frige, experationDate)
            {
            }
            public override bool Equals(object? obj)
            {
                return base.Equals(obj);
            }

            public override int GetHashCode()
            {
                return base.GetHashCode();
            }

            public override string? ToString()
            {
                return base.ToString();
            }
        }
        public class ExpirationManager
        {
            public Dictionary<string, DateTime> expirationDateDictionary { get; set; }

            public ExpirationManager(List<Item> itemsInFrige)
            {
                expirationDateDictionary = new Dictionary<string, DateTime>();
                foreach (Item item in itemsInFrige)
                {
                    expirationDateDictionary.Add(item.name, item.experationDate);
                }
            }
            public void AddItemToDictionary(Item item)
            {
                if (item != null && !(expirationDateDictionary.ContainsKey(item.name)))
                {
                    expirationDateDictionary.Add(item.name, item.experationDate);
                }
            }
            public void RemoveItemFromDictionary(Item item)
            {
                if (item != null && expirationDateDictionary.ContainsKey(item.name))
                {
                    expirationDateDictionary.Remove(item.name);
                }
            }
            public override bool Equals(object? obj)
            {
                return base.Equals(obj);
            }

            public override int GetHashCode()
            {
                return base.GetHashCode();
            }

            public override string? ToString()
            {
                return base.ToString();
            }
        }
        public class UserProfile
        {
            public List<string> userPreferences { get; set; }
            public List<string> itemsUserCannotEat { get; set; }
            public List<string> favoriteItemsOfUser { get; set; }

            public UserProfile(List<string> userPreferences, List<string> itemsUserCannotEat, List<string> favoriteItemsOfUser)
            {
                this.userPreferences = userPreferences;
                this.itemsUserCannotEat = itemsUserCannotEat;
                this.favoriteItemsOfUser = favoriteItemsOfUser;
            }

            public override bool Equals(object? obj)
            {
                return base.Equals(obj);
            }

            public override int GetHashCode()
            {
                return base.GetHashCode();
            }

            public override string? ToString()
            {
                return base.ToString();
            }
        }
        public class SmartItemManager
        {
            public List<Item> itemsInFrige { get; set; }
            public Dictionary<string, float> itemPrices { get; set; }
            public List<Tuple<string, int>> itemsNeededInFrige { get; set; }
            public List<Tuple<string, int>> shoppingList { get; set; }
            public float shoppingListPrice { get; set; }
            ExpirationManager expirationManager { get; set; }


            public SmartItemManager(List<Tuple<string, int>> usersRequestForFoodInFrige)
            {
                this.itemsInFrige = new List<Item>();
                this.itemPrices = new Dictionary<string, float>();
                this.itemsNeededInFrige = usersRequestForFoodInFrige;
                this.shoppingList = new List<Tuple<string, int>>();
                shoppingListPrice = 0;
                expirationManager = new ExpirationManager(this.itemsInFrige);
            }
            public void Get_Alert_Of_Expiration()
            {
                foreach (KeyValuePair<string, DateTime> keyValuePair in this.expirationManager.expirationDateDictionary)
                {
                    if (keyValuePair.Value <= DateTime.Now.AddDays(3))
                    {
                        Console.WriteLine("The {0} is about to expire!!!", keyValuePair.Key);
                    }
                }
            }
            public void Create_Shopping_List()
            {
                foreach (Tuple<string, int> itemSet in this.itemsNeededInFrige)
                {
                    foreach (Item item in this.itemsInFrige)
                    {
                        if (item.name == itemSet.Item1)
                        {
                            if (item.amount_in_frige < itemSet.Item2)
                            {
                                shoppingList.Add(new Tuple<string, int>(item.name, itemSet.Item2 - item.amount_in_frige));
                                shoppingListPrice += (itemSet.Item2 - item.amount_in_frige) * itemPrices[item.name];
                            }
                        }
                    }
                }
            }
            public void UpdatePriceDictionary(string item, float price)
            {
                if (itemPrices.ContainsKey(item))
                {
                    itemPrices[item] = price;
                }
                else
                {
                    itemPrices.Add(item, price);
                }
            }
            public void Add_Item(Item item)
            {
                if (item != null)
                    itemsInFrige.Add(item);
            }
            public void Remove_Item(Item item)
            {
                if (item != null && itemsInFrige.Contains(item))
                    itemsInFrige.Remove(item);
            }
            public void Update_Item_Taken_Out(Item item, int amountTakenOut)
            {
                item.amount_in_frige -= amountTakenOut;
                if (item.amount_in_frige <= 0)
                {
                    itemsInFrige.Remove(item);
                }
            }
            public void Update_Item_Put_In(Item item, int amountPutIn)
            {
                if (itemsInFrige.Contains(item))
                {
                    item.amount_in_frige += amountPutIn;
                }
                else
                {
                    itemsInFrige.Add(item);
                    item.amount_in_frige = amountPutIn;

                }
            }
            public override bool Equals(object? obj)
            {
                return base.Equals(obj);
            }

            public override int GetHashCode()
            {
                return base.GetHashCode();
            }

            public override string? ToString()
            {
                return base.ToString();
            }
        }
        public static string GetCommandFromUser()
        {
            Console.Write("Please choose a command! ");
            Console.WriteLine("(content of frige, exp date of products, shopping list, add comment, add reminder, exit)");
            string usersRequest = Console.ReadLine();
            return usersRequest;
        }
        static void Main(string[] args)
        {
            SmartItemManager Frige = new SmartItemManager(new List<Tuple<string, int>>());
            Console.WriteLine("Welcome To Your Smart Refrigerator! We Are Glad To Have You!");
            string usersRequest = GetCommandFromUser();
            while (true)
            {
                if (usersRequest.Equals("content of frige"))
                {
                    Console.WriteLine("The frige contains the following items: ");
                    foreach (Item item in Frige.itemsInFrige)
                    {
                        Console.Write(item.name + ",");
                    }
                }
                else if (usersRequest.Equals("exp date of products"))
                {
                    Frige.Get_Alert_Of_Expiration();
                }
                else if (usersRequest.Equals("shopping list"))
                {
                    Frige.Create_Shopping_List();
                    foreach (Tuple<string, int> itemSet in Frige.shoppingList)
                    {
                        Console.WriteLine(itemSet.Item1 + ":" + itemSet.Item2);
                    }
                }
                else if (usersRequest.Equals("add comment"))
                {
                    Console.WriteLine("What's the name of the item?");
                    string itemName = Console.ReadLine();
                    Console.WriteLine("Enter your comment: ");
                    string comment = Console.ReadLine();
                    foreach (Item item in Frige.itemsInFrige)
                    {
                        if (item.name.Equals(itemName))
                        {
                            item.commentAboutItem = comment;
                            Console.WriteLine("Comment Added!");
                        }
                    }
                }
                else if (usersRequest.Equals("add reminder"))
                {
                    Console.WriteLine("What's the name of the item?");
                    string itemName = Console.ReadLine();
                    Console.WriteLine("Enter your reminder: ");
                    string reminder = Console.ReadLine();
                    foreach (Item item in Frige.itemsInFrige)
                    {
                        if (item.name.Equals(itemName))
                        {
                            item.reminderRegardingItem = reminder;
                            Console.WriteLine("Reminder Added!");
                        }
                    }
                }
                else if (usersRequest.Equals("exit"))
                {
                    break;
                }
                else
                {
                    Console.WriteLine("I did not understand the command. Please try again!");
                }
                usersRequest = GetCommandFromUser();
            }
            Console.WriteLine("Thank You! Have A Great Time!");
        }
    }
}